<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ... head (links, title, etc) no cambia ... -->
    <link rel="stylesheet" href="admin-styles.css">

    <!-- Librería para exportar a Excel (XLSX) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Script de Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        // =============================================
        // CAMBIO: Imports de Firestore actualizados
        // =============================================
        import { 
            getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, writeBatch, 
            serverTimestamp, addDoc, query, orderBy, limit 
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"; 
        // =============================================
        
        // Configuración de Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyCha4S_wLxI_CZY1Tc9FOJNA3cUTggISpU",
          authDomain: "brakexadmin.firebaseapp.com",
          projectId: "brakexadmin",
          storageBucket: "brakexadmin.firebasestorage.app",
          messagingSenderId: "799264562947",
          appId: "1:799264562947:web:52d860ae41a5c4b8f75336"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Exponer herramientas de Firebase a la ventana global
        window.firebaseTools = {
            auth,
            db,
            collection,
            doc,
            setDoc,
            deleteDoc,
            onSnapshot,
            onAuthStateChanged,
            writeBatch,
            signInWithEmailAndPassword,
            signOut,
            // =============================================
            // NUEVO: Exponer nuevas herramientas
            // =============================================
            serverTimestamp,
            addDoc,
            query,
            orderBy,
            limit
            // =============================================
        };
    </script>
</head>
<body>
    
    <!-- ... Contenedor de Login no cambia ... -->
    <div id="login-container" class="login-container">
        <!-- ... (contenido de login card) ... -->
    </div>


    <!-- Panel principal -->
    <div class="app-container" id="main-app-container" style="display: none;">
        
        <main class="main-content">
            
            <header class="content-header">
                <div class="header-left">
                    <div class="header-logo-group">
                        <span class="material-icons-outlined logo-icon">speed</span>
                        <span class="logo-text">Brake X Admin 2.3</span>
                    </div>
                    <nav class="nav-menu">
                        <a href="#" class="nav-item active" data-section="dashboard">
                            <span class="material-icons-outlined">dashboard</span>
                            <span>Dashboard</span>
                        </a>
                        <a href="#" class="nav-item" data-section="edit-pad">
                            <span class="material-icons-outlined">edit_note</span>
                            <span>Añadir / Editar</span>
                        </a>
                        <a href="#" class="nav-item" data-section="export-data">
                            <span class="material-icons-outlined">download</span>
                            <span>Exportar Datos</span>
                        </a>
                        <!-- ============================================= -->
                        <!-- NUEVO: Enlace de Historial 
                        <!-- ============================================= -->
                        <a href="#" class="nav-item" data-section="history-log">
                            <span class="material-icons-outlined">history</span>
                            <span>Historial</span>
                        </a>
                        <!-- ============================================= -->
                    </nav>
                </div>
                <div class="header-right">
                     <!-- ... (botón de logout) ... -->
                </div>
            </header>
            
            <div class="content-wrapper">
                
                <h1 id="page-title">Dashboard</h1>
                
                <!-- ... Sección Dashboard no cambia ... -->
                <div id="dashboard" class="content-section active">
                    <!-- ... (contenido de dashboard) ... -->
                </div>

                <!-- ... Sección Añadir / Editar no cambia ... -->
                <div id="edit-pad" class="content-section">
                    <!-- ... (contenido de edit-pad) ... -->
                </div> 

                <!-- ... Sección de Exportar Datos no cambia ... -->
                <div id="export-data" class="content-section">
                    <!-- ... (contenido de export-data) ... -->
                </div>

                <!-- ============================================= -->
                <!-- NUEVO: Sección de Historial
                <!-- ============================================= -->
                <div id="history-log" class="content-section">
                    <div class="card">
                        <h2 class="card-title">Historial de Cambios</h2>
                        <p class="card-description">Muestra las últimas 50 acciones realizadas por los administradores. Los nuevos registros pueden tardar unos segundos en aparecer.</p>
                        <div class="history-log-table-wrapper">
                            <table class="history-log-table">
                                <thead>
                                    <tr>
                                        <th>Usuario</th>
                                        <th>Acción</th>
                                        <th>ID Pastilla</th>
                                        <th>Fecha y Hora</th>
                                    </tr>
                                </thead>
                                <tbody id="history-log-table-body">
                                    <!-- Las filas se insertarán aquí por JS -->
                                    <tr class="empty-row-placeholder">
                                        <td colspan="4">Cargando historial...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- ============================================= -->

            </div>
        </main>
    </div>

    <!-- ... Botón de Tema y Modal no cambian ... -->
    
    <script type="module" src="admin-script.js"></script> 
</body>
</html>
