<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brake X Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="admin-styles.css">

    <!-- Librería XLSX local para evitar advertencias -->
    <script src="xlsx.full.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signInWithEmailAndPassword,
            signOut,
            setPersistence,
            browserSessionPersistence
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        
        import { 
            getFirestore, collection, doc, setDoc, deleteDoc, onSnapshot, writeBatch, 
            serverTimestamp, addDoc, query, orderBy, limit 
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"; 
        
        // ✅ TU CONFIGURACIÓN (correcta)
        const firebaseConfig = {
          apiKey: "AIzaSyCha4S_wLxI_CZY1Tc9FOJNA3cUTggISpU",
          authDomain: "brakexadmin.firebaseapp.com",
          projectId: "brakexadmin",
          storageBucket: "brakexadmin.firebasestorage.app",
          messagingSenderId: "799264562947",
          appId: "1:799264562947:web:52d860ae41a5c4b8f75336"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseTools = {
            auth, db, collection, doc, setDoc, deleteDoc, onSnapshot, onAuthStateChanged,
            signInWithEmailAndPassword, signOut, serverTimestamp, addDoc, query, orderBy, limit,
            setPersistence, browserSessionPersistence
        };
    </script>
</head>
<body>
    <!-- LOGIN -->
    <div id="login-container" class="login-container">
        <div class="card login-card">
            <div class="header-logo-group" style="justify-content: center; margin-bottom: 1.5rem;">
                <span class="material-icons-outlined logo-icon">speed</span>
                <span class="logo-text">Brake X Admin</span>
            </div>
            <form id="login-form" class="form-grid" style="grid-template-columns: 1fr;" onsubmit="return false;">
                <div class="form-group">
                    <label for="login-email" class="input-label">Email</label>
                    <input type="email" id="login-email" class="text-input" required>
                </div>
                <div class="form-group">
                    <label for="login-password" class="input-label">Contraseña</label>
                    <div class="input-wrapper-relative"> 
                        <input type="password" id="login-password" class="text-input" required>
                        <button type="button" id="login-password-toggle" class="btn-icon-toggle">
                            <span class="material-icons-outlined">visibility</span>
                        </button>
                    </div>
                </div>
                <p id="login-message" class="status-message"></p>
                <button id="login-btn" class="btn btn-primary" type="submit">
                    <span class="material-icons-outlined">login</span>
                    <span>Ingresar</span>
                </button>
            </form>
        </div>
    </div>

    <!-- PANEL PRINCIPAL -->
    <div class="app-container" id="main-app-container" style="display: none;">
        <!-- CONTENIDO PRINCIPAL (igual que antes, pero con el botón VIN) -->
        <main class="main-content">
            <header class="content-header">
                <div class="header-left">
                    <div class="header-logo-group">
                        <span class="material-icons-outlined logo-icon">speed</span>
                        <span class="logo-text">Brake X Admin 2.6</span>
                    </div>
                    <nav class="nav-menu">
                        <a href="#" class="nav-item active" data-section="dashboard">
                            <span class="material-icons-outlined">dashboard</span>
                            <span>Dashboard</span>
                        </a>
                        <a href="#" class="nav-item" data-section="edit-pad">
                            <span class="material-icons-outlined">edit_note</span>
                            <span>Añadir / Editar</span>
                        </a>
                        <a href="#" class="nav-item" data-section="export-data">
                            <span class="material-icons-outlined">download</span>
                            <span>Exportar Datos</span>
                        </a>
                        <a href="#" class="nav-item" data-section="history-log">
                            <span class="material-icons-outlined">history</span>
                            <span>Historial</span>
                        </a>
                    </nav>
                </div>
                <div class="header-right">
                     <button id="logout-btn" class="btn btn-outline" type="button">
                         <span class="material-icons-outlined">logout</span>
                         <span>Cerrar Sesión</span>
                    </button>
                </div>
            </header>
            
            <div class="content-wrapper">
                <!-- SECCIONES IGUALES -->
                <h1 id="page-title">Dashboard</h1>
                
                <div id="dashboard" class="content-section active">
                    <!-- contenido... -->
                </div>

                <div id="edit-pad" class="content-section">
                    <div class="edit-layout-grid">
                        <div class="layout-col-main">
                            <!-- formularios... -->
                        </div>
                        <div class="layout-col-sidebar">
                            <div class="card card-sticky"> 
                                <h2 class="card-title">Aplicaciones (Vehículos)</h2>
                                <p class="card-description" id="app-form-description">Añade vehículos compatibles.</p>
                                <form id="app-form" class="form-grid cols-2" onsubmit="return false;">
                                    <div class="form-group"> 
                                        <label for="app-marca" class="input-label">Marca</label> 
                                        <input type="text" id="app-marca" class="text-input" required list="marcas-list">
                                        <!-- ✅ BOTÓN VIN -->
                                        <button type="button" id="vin-lookup-btn" class="btn btn-outline" style="margin-top: 0.5rem; padding: 0.4rem 0.8rem; font-size: 0.85rem;">
                                            <span class="material-icons-outlined" style="font-size: 1rem;">directions_car</span>
                                            Buscar por VIN
                                        </button>
                                    </div>
                                    <div class="form-group"> 
                                        <label for="app-serie" class="input-label">Serie / Modelo</label> 
                                        <input type="text" id="app-serie" class="text-input" required list="series-list"> 
                                    </div>
                                    <div class="form-group"> 
                                        <label for="app-litros" class="input-label">Litros / Motor</label> 
                                        <input type="text" id="app-litros" class="text-input"> 
                                    </div>
                                    <div class="form-group"> 
                                        <label for="app-anio" class="input-label">Año(s)</label> 
                                        <input type="text" id="app-anio" class="text-input" placeholder="Ej: 99 o 99-05"> 
                                    </div>
                                    <div class="form-group span-2"> 
                                        <label for="app-especificacion" class="input-label">Especificación (Opcional)</label> 
                                        <input type="text" id="app-especificacion" class="text-input" placeholder="Ej: 4WD, Sedan, etc."> 
                                    </div>
                                    <div class="form-group span-2 button-group">
                                        <button id="add-update-app-btn" type="submit" class="btn btn-tertiary"> 
                                            <span class="material-icons-outlined">add_circle</span> 
                                            <span id="add-app-button-text">Añadir App</span> 
                                        </button>
                                        <button type="button" id="cancel-edit-app-btn" class="btn btn-outline" style="display: none;"> 
                                            <span class="material-icons-outlined">cancel</span> Cancelar Edición 
                                        </button>
                                    </div>
                                </form>
                                <datalist id="marcas-list"></datalist>
                                <datalist id="series-list"></datalist>
                                <div class="form-group" style="margin-top: 1rem; margin-bottom: 0.5rem;">
                                    <label for="filter-apps-input" class="input-label">Filtrar aplicaciones actuales:</label>
                                    <input type="text" id="filter-apps-input" class="text-input" placeholder="Ej: Spark o 2010">
                                </div>
                                <h3 class="list-title">Aplicaciones Actuales / Añadidas:</h3>
                                <ul id="current-apps-list" class="app-list"> <li class="empty-list">Ninguna todavía</li> </ul>
                            </div>
                        </div>
                    </div> 
                </div> 

                <!-- OTRAS SECCIONES -->
                <div id="export-data" class="content-section">
                    <!-- exportar -->
                </div>
                <div id="history-log" class="content-section">
                    <!-- historial -->
                </div>
            </div>
        </main>
    </div>

    <!-- MODALES -->
    <!-- Confirmación -->
    <div id="confirm-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="card modal-card">
            <h2 class="card-title" id="confirm-modal-title">Confirmar Acción</h2>
            <p class="card-description" id="confirm-modal-message">¿Estás seguro?</p>
            <div class="button-group modal-buttons">
                <button id="confirm-modal-btn-no" class="btn btn-outline" type="button">Cancelar</button>
                <button id="confirm-modal-btn-yes" class="btn btn-danger" type="button">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- ✅ MODAL DE VIN -->
    <div id="vin-modal-overlay" class="modal-overlay" style="display: none;">
        <div class="card modal-card" style="max-width: 450px; width: 90%;">
            <h2 class="card-title">Buscar por VIN</h2>
            <p class="card-description">Ingresa un VIN válido de 17 caracteres.</p>
            <form id="vin-form" class="form-grid" style="gap: 1rem; margin-top: 0.5rem;" onsubmit="return false;">
                <div class="form-group">
                    <label for="vin-input" class="input-label">VIN (17 caracteres)</label>
                    <input type="text" id="vin-input" class="text-input" maxlength="17" placeholder="Ej: 1HGCM82633A123456" autocomplete="off">
                    <p id="vin-feedback" class="status-message" style="margin-top: 0.5rem;"></p>
                </div>
                <div class="button-group modal-buttons">
                    <button type="button" id="vin-cancel-btn" class="btn btn-outline">Cancelar</button>
                    <button type="submit" id="vin-submit-btn" class="btn btn-primary">Buscar</button>
                </div>
            </form>
        </div>
    </div>
    
    <script type="module" src="admin-script.js"></script> 
</body>
</html>
