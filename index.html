<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brake X Admin</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <link rel="stylesheet" href="admin-styles.css">
</head>
<body>

    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <span class="material-icons-outlined logo-icon">speed</span>
                <span class="logo-text">Brake X Admin 1.1</span>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <span class="material-icons-outlined">dashboard</span>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="edit-pad">
                    <span class="material-icons-outlined">edit_note</span>
                    <span>Añadir / Editar</span>
                </a>
                <a href="#" class="nav-item" data-section="export-data">
                    <span class="material-icons-outlined">file_download</span>
                    <span>Exportar Datos</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <span class="material-icons-outlined">settings</span>
                    <span>Configuración</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="content-header">
                <h1 id="page-title">Dashboard</h1>
            </header>

            <div class="content-wrapper">

                <div id="dashboard" class="content-section active">
                    <div class="card-grid cols-2">
                        <div class="stat-card accent-blue">
                            <span class="material-icons-outlined stat-icon">inventory_2</span>
                            <div class="stat-info">
                                <span class="stat-value" id="pad-count-dashboard">0</span>
                                <span class="stat-label">Pastillas Cargadas</span>
                            </div>
                        </div>
                        <div class="stat-card accent-green">
                            <span class="material-icons-outlined stat-icon">app_registration</span>
                             <div class="stat-info">
                                <span class="stat-value" id="apps-total-dashboard">0</span>
                                <span class="stat-label">Aplicaciones Totales</span>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Cargar `data.json` o `.xlsx`</h2>
                        <p class="card-description">Carga tu archivo <strong>data.json</strong> o <strong>JSON.xlsx</strong> para empezar a añadir o modificar datos.</p>
                        <div class="file-upload-wrapper">
                            <input type="file" id="file-import" accept=".json, .xlsx, .xls" class="file-input">
                            <label for="file-import" class="btn btn-secondary file-btn">
                                <span class="material-icons-outlined">upload_file</span> Seleccionar archivo...
                            </label>
                            <span id="file-name" class="file-name">Ningún archivo.</span>
                        </div>
                        <span id="import-status" class="status-message"></span>
                    </div>
                </div>

                <div id="edit-pad" class="content-section">
                    <div class="card">
                         <h2 class="card-title">Buscar Pastilla para Editar</h2>
                         <div class="form-group">
                             <label for="search-ref" class="input-label">Buscar por Referencia</label>
                             <div class="search-wrapper">
                                 <input type="text" id="search-ref" class="text-input" placeholder="Ej: 7104INC">
                                 <button id="search-btn" class="btn btn-secondary search-btn" type="button"> <span class="material-icons-outlined">search</span> </button>
                             </div>
                         </div>
                         <div id="search-results" class="search-results-container"></div>
                         <button id="clear-search-btn" class="btn btn-outline" type="button" style="display: none; margin-top: 1rem;">Limpiar Formulario</button>
                    </div>
                    <div class="card">
                        <h2 class="card-title" id="form-mode-title">Añadir Nueva Pastilla</h2>
                        <form id="pad-form-main" class="form-grid" onsubmit="return false;">
                           <input type="hidden" id="edit-index" value="-1">
                            <div class="form-group span-2"> <label for="pad-ref" class="input-label">Referencias (separadas por coma)</label> <input type="text" id="pad-ref" class="text-input" required> </div>
                            <div class="form-group"> <label for="pad-oem" class="input-label">OEM (separados por coma)</label> <input type="text" id="pad-oem" class="text-input"> </div>
                            <div class="form-group"> <label for="pad-fmsi" class="input-label">FMSI (separados por coma)</label> <input type="text" id="pad-fmsi" class="text-input"> </div>
                            <div class="form-group"> <label for="pad-posicion" class="input-label">Posición</label> <select id="pad-posicion" class="select-input"> <option value="Delantera">Delantera</option> <option value="Trasera">Trasera</option> </select> </div>
                            <div class="form-group"> <label for="pad-medidas" class="input-label">Medidas (Ej: Ancho x Alto)</label> <input type="text" id="pad-medidas" class="text-input" placeholder="Ej: 131.5 x 52.5"> </div>
                            <div class="form-group span-2"> <label for="pad-imagenes" class="input-label">URLs Imágenes (separadas por coma)</label> <input type="text" id="pad-imagenes" class="text-input" placeholder="url1.jpg, url2.jpg, ..."> </div>
                        </form>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Aplicaciones (Vehículos)</h2>
                         <p class="card-description" id="app-form-description">Añade vehículos compatibles.</p>
                        <form id="app-form" class="form-grid cols-2" onsubmit="return false;">
                             <input type="hidden" id="editing-app-index" value="-1">
                             <div class="form-group"> <label for="app-marca" class="input-label">Marca</label> <input type="text" id="app-marca" class="text-input" required> </div>
                             <div class="form-group"> <label for="app-serie" class="input-label">Serie / Modelo</label> <input type="text" id="app-serie" class="text-input" required> </div>
                             <div class="form-group"> <label for="app-litros" class="input-label">Litros / Motor</label> <input type="text" id="app-litros" class="text-input"> </div>
                             <div class="form-group"> <label for="app-anio" class="input-label">Año(s)</label> <input type="text" id="app-anio" class="text-input" placeholder="Ej: 85-95 o 99"> </div>
                             <div class="form-group span-2"> <label for="app-especificacion" class="input-label">Especificación (Opcional)</label> <input type="text" id="app-especificacion" class="text-input" placeholder="Ej: 4WD, Sedan, etc."> </div>
                             <div class="form-group span-2 button-group">
                                 <button id="add-update-app-btn" type="submit" class="btn btn-tertiary"> <span class="material-icons-outlined">add_circle</span> <span id="add-app-button-text">Añadir App</span> </button>
                                 <button type="button" id="cancel-edit-app-btn" class="btn btn-outline" style="display: none;"> <span class="material-icons-outlined">cancel</span> Cancelar Edición </button>
                             </div>
                        </form>
                        <h3 class="list-title">Aplicaciones Actuales / Añadidas:</h3>
                        <ul id="current-apps-list" class="app-list"> <li class="empty-list">Ninguna todavía</li> </ul>
                        
                        <span id="save-pad-status" class="status-message" style="margin-bottom: 1rem;"></span>
                        
                        <button id="save-pad-btn" class="btn btn-primary btn-cta" type="button"> <span class="material-icons-outlined">save</span> <span id="save-button-text">Guardar Pastilla</span> </button>
                    </div>
                </div>

                <div id="export-data" class="content-section">
                     <div class="card">
                        <h2 class="card-title">Generar y Descargar Archivos</h2>
                        <p class="card-description">Descarga el archivo <strong>data.json</strong> (compacto, 1 línea por objeto) o un archivo <strong>data.xlsx</strong> (formato de una fila por aplicación).</p>
                        <div class="button-group">
                            <button id="generate-download-btn" class="btn btn-primary" type="button"> <span class="material-icons-outlined">file_download</span> Descargar JSON </button>
                            <button id="export-excel-btn" class="btn btn-tertiary" type="button"> <span class="material-icons-outlined">grid_on</span> Exportar a Excel </button>
                        </div>
                        <span id="download-status" class="status-message"></span>
                    </div>
                    <div class="card">
                        <h2 class="card-title">Previsualización del JSON (Formateado)</h2>
                        <textarea id="json-output" readonly class="text-area-output" placeholder="Presiona 'Descargar JSON' para generar la vista previa..."></textarea>
                        <button id="copy-json-btn" class="btn btn-secondary" type="button"> <span class="material-icons-outlined">content_copy</span> Copiar JSON Formateado </button>
                        <span id="copy-status" class="status-message"></span>
                    </div>
                </div>

                <div id="settings" class="content-section">
                    <div class="card">
                        <h2 class="card-title">Configuración de Sesión</h2>
                        <p class="card-description">Borra todos los datos cargados actualmente en esta sesión del navegador. Esta acción **NO** afecta tu archivo `data.json` guardado.</p>
                        <button id="clear-all-btn" class="btn btn-danger" type="button"> <span class="material-icons-outlined">delete_sweep</span> Limpiar Sesión Actual </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

     <div class="floating-buttons-container right">
        <button class="material-btn" id="darkBtn" aria-label="Cambiar modo oscuro" aria-pressed="false" type="button">
            <svg class="lp-icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="4"></line><line x1="12" y1="20" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="6.34" y2="6.34"></line><line x1="17.66" y1="17.66" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="4" y2="12"></line><line x1="20" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="6.34" y2="17.66"></line><line x1="17.66" y1="6.34" x2="19.78" y2="4.22"></line></svg>
            <svg class="lp-icon-moon" viewBox="0 0 24 24" style="opacity:0;"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
    </div>

    <div id="confirm-modal-overlay" class="modal-overlay" style="display: none;">
        <div id="confirm-modal-content" class="card modal-card">
            <h2 class="card-title" id="confirm-modal-title">Confirmar Acción</h2>
            <p class="card-description" id="confirm-modal-message">¿Estás seguro?</p>
            <div class="button-group modal-buttons">
                <button id="confirm-modal-btn-no" class="btn btn-outline" type="button">Cancelar</button>
                <button id="confirm-modal-btn-yes" class="btn btn-danger" type="button">Confirmar</button>
            </div>
        </div>
    </div>

    <script src="admin-script.js"></script>
</body>
</html>